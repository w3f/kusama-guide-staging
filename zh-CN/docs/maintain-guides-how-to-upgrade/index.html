<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="Guide" href="/zh-CN/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&display=swap">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js" onload="addBackToTop()" defer="defer"></script>
<script src="https://apisa.web3.foundation/latest.js" async defer="defer"></script>
<script src="../js/custom.js"></script>
<script src="../js/clipboard.min.js"></script>
<script src="../js/copycode.js"></script><title data-react-helmet="true">How to Upgrade Your Validator · Guide</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://guide.kusama.network/zh-CN/docs/maintain-guides-how-to-upgrade"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to Upgrade Your Validator · Guide"><meta data-react-helmet="true" name="description" content="Validators perform critical functions for the network, and as such, have strict uptime requirements. Validators may have to go offline for short-periods of time to upgrade client software or to upgrade the host machine. Usually, standard client upgrades will only require you to stop the service, replace the binary and restart the service.  This operation can be executed within a session and if performed correctly will not produce a slashable event."><meta data-react-helmet="true" property="og:description" content="Validators perform critical functions for the network, and as such, have strict uptime requirements. Validators may have to go offline for short-periods of time to upgrade client software or to upgrade the host machine. Usually, standard client upgrades will only require you to stop the service, replace the binary and restart the service.  This operation can be executed within a session and if performed correctly will not produce a slashable event."><link data-react-helmet="true" rel="shortcut icon" href="/zh-CN/img/Kusama_Canary_white.png"><link data-react-helmet="true" rel="canonical" href="https://guide.kusama.network/zh-CN/docs/maintain-guides-how-to-upgrade"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/docs/maintain-guides-how-to-upgrade" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/zh-CN/docs/maintain-guides-how-to-upgrade" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/docs/maintain-guides-how-to-upgrade" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.e0c2e7f9.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.4084311b.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.638aeb07.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh-CN/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Guide</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-CN/docs/kusama-getting-started">Docs</a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/zh-CN/docs/contributing">Contribute</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/maintain-guides-how-to-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-CN/docs/maintain-guides-how-to-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help us translate</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to Upgrade Your Validator</h1></header><p>Validators perform critical functions for the network, and as such, have strict uptime requirements. Validators may have to go offline for short-periods of time to upgrade client software or to upgrade the host machine. Usually, standard client upgrades will only require you to stop the service, replace the binary and restart the service.  This operation can be executed within a session and if performed correctly will not produce a slashable event.</p><p>Validators may also need to perform long-lead maintenance tasks that will span more than one session.  Under these circumstances, an active validator may chill their stash and be removed from the active validator set.  Alternatively, the validator may substitute the active validator server with another allowing the former to undergo maintenance activities.</p><p>This guide will provide an option for validators to seamlessly substitute an active validator server to allow for maintenance operations. </p><p>The process can take several hours, so make sure you understand the instructions first and plan accordingly.</p><blockquote><p>Note: keep an eye out on new releases from the community and upgrade/downgrade accordingly.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="key-components">Key Components<a aria-hidden="true" class="hash-link" href="#key-components" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="session-keys">Session Keys<a aria-hidden="true" class="hash-link" href="#session-keys" title="Direct link to heading">​</a></h3><p>Session keys are stored in the client and used to sign validator operations. They are what link your validator node to your Controller account. If you change them within a session you will have to wait for the current session to finish and a further two sessions to elapse before they are applied.</p><p><a href="/zh-CN/docs/learn-keys">More info about keys in Polkadot.</a></p><h3 class="anchor anchorWithStickyNavbar_31ik" id="keystore">Keystore<a aria-hidden="true" class="hash-link" href="#keystore" title="Direct link to heading">​</a></h3><p>Each validator server contains essential private keys in a folder called the <em>keystore</em>. These keys are used by a validator to sign transactions at the network level.  If two or more validators sign certain transactions using the same keys, it can lead to an <a href="/zh-CN/docs/learn-staking/#slashing">equivocation slash</a>.</p><p>For this reason, it is advised that validators DO NOT CLONE or COPY the <em>keystore</em> folder and instead generate session keys for each new validator instance.</p><p>Default keystore path - <code>/home/polkadot/.local/share/polkadot/chains/&lt;chain&gt;/keystore</code></p><h2 class="anchor anchorWithStickyNavbar_31ik" id="steps">Steps<a aria-hidden="true" class="hash-link" href="#steps" title="Direct link to heading">​</a></h2><p>The following steps require a second validator which will be referred to as <code>Validator B</code>; the original server that is in the active set will be referred to as <code>Validator A</code>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="session-n">Session <code>N</code><a aria-hidden="true" class="hash-link" href="#session-n" title="Direct link to heading">​</a></h3><ol><li>Start a second node. Once it is synced, use the <code>--validator</code> flag. This is now &quot;Validator B.&quot;</li><li>Generate Session keys for <strong>Validator B</strong>.</li><li>Submit a <code>set_key</code> extrinsic from your Controller account with the session key generated from <strong>Validator B</strong>.</li><li>Take note of the Session that this extrinsic was executed in.</li><li>Allow the current session to elapse and then wait for two full sessions. </li></ol><p><strong>It is imperative that you keep Validator A running during this time.</strong> <code>set_key</code> does not have an immediate effect and requires two full sessions to elapse before it does.  If you do switch off Validator A too early you may risk being chilled and face a fault within the Thousand Validator Programme.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="session-n3">Session <code>N+3</code><a aria-hidden="true" class="hash-link" href="#session-n3" title="Direct link to heading">​</a></h3><p><strong>Validator B</strong> is now acting as your validator - you can safely perform operations on <strong>Validator A</strong>.</p><p>When you are ready to restore <strong>Validator A</strong>:</p><ol><li>Start <strong>Validator A</strong>, sync the database and ensure that it is operating with the <code>--validator</code> flag.</li><li>Generate new Session keys for <strong>Validator A</strong>.</li><li>Submit a <code>set_key</code> extrinsic from your Controller account with the session key generated from <strong>Validator A</strong>.</li><li>Take note of the Session that this extrinsic was executed in.</li></ol><p><strong>Again, it is imperative that Validator B is kept running until the current session finishes and two further full sessions have elapsed.</strong></p><p>Once this time has elapsed, <strong>Validator A</strong> will take over. You can safely stop Validator B.</p><p><strong>NOTE:</strong> To verify that the Session has changed, make sure that a block in the new Session is finalized. You should see log messages like the ones below to confirm the change:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">2019-10-28 21:44:13 Applying authority set change scheduled at block #450092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2019-10-28 21:44:13 Applying GRANDPA set change to new set with 20 authorities</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/w3f/polkadot-wiki/edit/master/docs/maintain/maintain-guides-how-to-upgrade.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2021-10-23T05:27:09.000Z">2021/10/23</time></b> by <b>Danny Salman</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-components" class="table-of-contents__link toc-highlight">Key Components</a><ul><li><a href="#session-keys" class="table-of-contents__link toc-highlight">Session Keys</a></li><li><a href="#keystore" class="table-of-contents__link toc-highlight">Keystore</a></li></ul></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a><ul><li><a href="#session-n" class="table-of-contents__link toc-highlight">Session <code>N</code></a></li><li><a href="#session-n3" class="table-of-contents__link toc-highlight">Session <code>N+3</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/zh-CN/" class="nav-home"><img src="/zh-CN/img/Kusama_Canary_white.png" alt="Guide" width="66" height="58"></a><div><a href="https://kusama.network/" target="_blank" class="homepage-font">Kusama Network</a><a href="https://polkadot.network/faq/" target="_blank" rel="noreferrer noopener" class="homepage-font">FAQ</a><a href="https://twitter.com/kusamanetwork" target="_blank" rel="noreferrer noopener" class="homepage-font">Twitter</a><a href="https://www.notion.so/web3foundation/Polkadot-Kusama-Community-Hub-ee1fd077ff6c42c381940404f6aa9f1c" target="_blank" rel="noreferrer noopener" class="homepage-font">Community Hub</a><a href="https://matrix.to/#/!HfRYKXBoPmDBCAWUEJ:polkadot.builders" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Watercooler</a><a href="https://github.com/w3f/General-Grants-Program" target="_blank" rel="noreferrer noopener" class="homepage-font">Grants and Bounties</a></div><div class="kusama-mainpage-cyber-row"><div class="kusama-mainpage-column"><h2 class="homepage-font-footer">Join a cyber secret society</h2><p class="homepage-font-footer">The Kappa Sigma Mu fraternity asks you to get a Kusama tattoo to join.</p><a href="/zh-CN/docs/maintain-guides-society-kusama"><button class="kusama-mainpage-build-footer">See Kappa Sigma Mu</button></a></div></div></section><section class="row"><div class="copyright homepage-font">© 2021 Web3 Foundation</div><a class="item homepage-font" href="https://polkadot.network/privacy/">Privacy Policy</a></section></footer></div>
<script src="/zh-CN/assets/js/runtime~main.4084311b.js"></script>
<script src="/zh-CN/assets/js/main.638aeb07.js"></script>
</body>
</html>